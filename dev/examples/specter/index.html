<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Traversal · Accessors.jl</title><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">Accessors.jl</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../../getting_started/">Getting started</a></li></ul></li><li><span class="tocitem">Explanation</span><ul><li><a class="tocitem" href="../../lenses/">Lenses</a></li></ul></li><li><span class="tocitem">Reference</span><ul><li><a class="tocitem" href="../../docstrings/">Docstrings</a></li></ul></li><li><span class="tocitem">How-to guides</span><ul><li><a class="tocitem" href="../custom_optics/">Custom Optics</a></li><li><a class="tocitem" href="../custom_macros/">Custom Macros</a></li></ul></li><li class="is-active"><a class="tocitem" href>Traversal</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Traversal</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Traversal</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/JuliaObjects/Accessors.jl/blob/master/examples/specter.jl" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Traversal"><a class="docs-heading-anchor" href="#Traversal">Traversal</a><a id="Traversal-1"></a><a class="docs-heading-anchor-permalink" href="#Traversal" title="Permalink"></a></h1><p>This code demonstrates how to use and extend advanced optics. The examples are taken from the README.md of the specter clojure library. Many of the features here are experimental, please consult the docstrings of the involved optics.</p><pre><code class="language-julia hljs">using Test
using Accessors

import Accessors: modify, OpticStyle
using Accessors: ModifyBased, SetBased, setindex</code></pre><h3 id="Increment-all-even-numbers"><a class="docs-heading-anchor" href="#Increment-all-even-numbers">Increment all even numbers</a><a id="Increment-all-even-numbers-1"></a><a class="docs-heading-anchor-permalink" href="#Increment-all-even-numbers" title="Permalink"></a></h3><p>We have the following data and the goal is to increment all nested even numbers.</p><pre><code class="language-julia hljs">data = (a = [(aa=1, bb=2), (cc=3,)], b = [(dd=4,)])</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">(a = NamedTuple[(aa = 1, bb = 2), (cc = 3,)], b = NamedTuple{(:dd,), Tuple{Int64}}[(dd = 4,)])</code></pre><p>To acomplish this, we define a new optic <code>Vals</code>.</p><pre><code class="language-julia hljs">function mapvals(f, d)
    Dict(k =&gt; f(v) for (k,v) in pairs(d))
end

mapvals(f, nt::NamedTuple) = map(f, nt)

struct Vals end
OpticStyle(::Type{Vals}) = ModifyBased()
modify(f, obj, ::Vals) = mapvals(f, obj)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">modify (generic function with 11 methods)</code></pre><p>Now we can increment as follows:</p><pre><code class="language-julia hljs">out = @set data |&gt; Vals() |&gt; Elements() |&gt; Vals() |&gt; If(iseven) += 1

@test out == (a = [(aa = 1, bb = 3), (cc = 3,)], b = [(dd = 5,)])</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Test Passed
  Expression: out == (a = [(aa = 1, bb = 3), (cc = 3,)], b = [(dd = 5,)])
   Evaluated: (a = NamedTuple[(aa = 1, bb = 3), (cc = 3,)], b = NamedTuple{(:dd,), Tuple{Int64}}[(dd = 5,)]) == (a = NamedTuple[(aa = 1, bb = 3), (cc = 3,)], b = NamedTuple{(:dd,), Tuple{Int64}}[(dd = 5,)])</code></pre><h3 id="Append-to-nested-vector"><a class="docs-heading-anchor" href="#Append-to-nested-vector">Append to nested vector</a><a id="Append-to-nested-vector-1"></a><a class="docs-heading-anchor-permalink" href="#Append-to-nested-vector" title="Permalink"></a></h3><pre><code class="language-julia hljs">data = (a = 1:3,)
out = @modify(v -&gt; vcat(v, [4,5]), data.a)

@test out == (a = [1,2,3,4,5],)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Test Passed
  Expression: out == (a = [1, 2, 3, 4, 5],)
   Evaluated: (a = [1, 2, 3, 4, 5],) == (a = [1, 2, 3, 4, 5],)</code></pre><h3 id="Increment-last-odd-number-in-a-sequence"><a class="docs-heading-anchor" href="#Increment-last-odd-number-in-a-sequence">Increment last odd number in a sequence</a><a id="Increment-last-odd-number-in-a-sequence-1"></a><a class="docs-heading-anchor-permalink" href="#Increment-last-odd-number-in-a-sequence" title="Permalink"></a></h3><pre><code class="language-julia hljs">data = 1:4
out = @set data |&gt; filter(isodd, _) |&gt; last += 1
@test out == [1,2,4,4]

### Map over a sequence

data = 1:3
out = @set data |&gt; Elements() += 1
@test out == [2,3,4]</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Test Passed
  Expression: out == [2, 3, 4]
   Evaluated: [2, 3, 4] == [2, 3, 4]</code></pre><h3 id="Increment-all-values-in-a-nested-Dict"><a class="docs-heading-anchor" href="#Increment-all-values-in-a-nested-Dict">Increment all values in a nested Dict</a><a id="Increment-all-values-in-a-nested-Dict-1"></a><a class="docs-heading-anchor-permalink" href="#Increment-all-values-in-a-nested-Dict" title="Permalink"></a></h3><pre><code class="language-julia hljs">data = Dict(:a =&gt; Dict(:aa =&gt;1), :b =&gt; Dict(:ba =&gt; -1, :bb =&gt; 2))
out = @set data |&gt; Vals() |&gt; Vals() += 1
@test out == Dict(:a =&gt; Dict(:aa =&gt; 2),:b =&gt; Dict(:bb =&gt; 3,:ba =&gt; 0))</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Test Passed
  Expression: out == Dict(:a =&gt; Dict(:aa =&gt; 2), :b =&gt; Dict(:bb =&gt; 3, :ba =&gt; 0))
   Evaluated: Dict(:a =&gt; Dict(:aa =&gt; 2), :b =&gt; Dict(:bb =&gt; 3, :ba =&gt; 0)) == Dict(:a =&gt; Dict(:aa =&gt; 2), :b =&gt; Dict(:bb =&gt; 3, :ba =&gt; 0))</code></pre><h3 id="Increment-all-the-even-values-for-:a-keys-in-a-sequence-of-maps"><a class="docs-heading-anchor" href="#Increment-all-the-even-values-for-:a-keys-in-a-sequence-of-maps">Increment all the even values for :a keys in a sequence of maps</a><a id="Increment-all-the-even-values-for-:a-keys-in-a-sequence-of-maps-1"></a><a class="docs-heading-anchor-permalink" href="#Increment-all-the-even-values-for-:a-keys-in-a-sequence-of-maps" title="Permalink"></a></h3><pre><code class="language-julia hljs">data = [Dict(:a =&gt; 1), Dict(:a =&gt; 2), Dict(:a =&gt; 4), Dict(:a =&gt; 3)]
out = @set data |&gt; Elements() |&gt; _[:a] += 1
@test out == [Dict(:a =&gt; 2), Dict(:a =&gt; 3), Dict(:a =&gt; 5), Dict(:a =&gt; 4)]</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Test Passed
  Expression: out == [Dict(:a =&gt; 2), Dict(:a =&gt; 3), Dict(:a =&gt; 5), Dict(:a =&gt; 4)]
   Evaluated: [Dict(:a =&gt; 2), Dict(:a =&gt; 3), Dict(:a =&gt; 5), Dict(:a =&gt; 4)] == [Dict(:a =&gt; 2), Dict(:a =&gt; 3), Dict(:a =&gt; 5), Dict(:a =&gt; 4)]</code></pre><h3 id="Retrieve-every-number-divisible-by-3-out-of-a-sequence-of-sequences"><a class="docs-heading-anchor" href="#Retrieve-every-number-divisible-by-3-out-of-a-sequence-of-sequences">Retrieve every number divisible by 3 out of a sequence of sequences</a><a id="Retrieve-every-number-divisible-by-3-out-of-a-sequence-of-sequences-1"></a><a class="docs-heading-anchor-permalink" href="#Retrieve-every-number-divisible-by-3-out-of-a-sequence-of-sequences" title="Permalink"></a></h3><pre><code class="language-julia hljs">data = [[1,2,3,4], Int[], [5,3,2,18], [2,4,6], [12]]
optic = @optic _ |&gt; Elements() |&gt; Elements() |&gt; If(x -&gt; mod(x, 3) == 0)
out = getall(data, optic)
@test out == [3, 3, 18, 6, 12]
@test eltype(out) == Int</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Test Passed
  Expression: eltype(out) == Int
   Evaluated: Int64 == Int64</code></pre><h3 id="Increment-the-last-odd-number-in-a-sequence"><a class="docs-heading-anchor" href="#Increment-the-last-odd-number-in-a-sequence">Increment the last odd number in a sequence</a><a id="Increment-the-last-odd-number-in-a-sequence-1"></a><a class="docs-heading-anchor-permalink" href="#Increment-the-last-odd-number-in-a-sequence" title="Permalink"></a></h3><pre><code class="language-julia hljs">data = [2, 1, 3, 6, 9, 4, 8]
out = @set data |&gt; filter(isodd, _) |&gt; _[end] += 1
@test out == [2, 1, 3, 6, 10, 4, 8]
@test eltype(out) == Int</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Test Passed
  Expression: eltype(out) == Int
   Evaluated: Int64 == Int64</code></pre><h3 id="Remove-nils-from-a-nested-sequence"><a class="docs-heading-anchor" href="#Remove-nils-from-a-nested-sequence">Remove nils from a nested sequence</a><a id="Remove-nils-from-a-nested-sequence-1"></a><a class="docs-heading-anchor-permalink" href="#Remove-nils-from-a-nested-sequence" title="Permalink"></a></h3><pre><code class="language-julia hljs">data = (a = [1,2,missing, 3, missing],)
optic = @optic _.a |&gt; filter(!ismissing, _)
out = optic(data)
@test out == [1,2,3]</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Test Passed
  Expression: out == [1, 2, 3]
   Evaluated: Union{Missing, Int64}[1, 2, 3] == [1, 2, 3]</code></pre><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../custom_macros/">« Custom Macros</a><a class="docs-footer-nextpage" href="../../internals/">Internals »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.25 on <span class="colophon-date" title="Monday 26 February 2024 17:53">Monday 26 February 2024</span>. Using Julia version 1.7.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
